import{h as f,m as n,n as h}from"./chunk-6M5HUDFR.js";import{I as d,M as a,R as c,ca as m,l as u,w as g}from"./chunk-SWFXP6AJ.js";var b="/auth/login",R=(r=>(r.ADMIN="admin",r.SUPER_VISOR="supervisor",r.EMPLOYEE="employee",r))(R||{}),w=[{label:"Admin",value:"admin"},{label:"Supervisor",value:"supervisor"},{label:"Employee",value:"employee"}],E=[10,20,30,50,100],N={pageNumber:1,pageSize:10,totalRecords:0,rowsPerPageOptions:E,showCurrentPageReport:!0,currentPageReportTemplate:"Showing {first} of {totalRecords}"};var i=class extends Error{};i.prototype.name="InvalidTokenError";function T(o){return decodeURIComponent(atob(o).replace(/(.)/g,(t,e)=>{let r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}function y(o){let t=o.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return T(t)}catch{return atob(t)}}function v(o,t){if(typeof o!="string")throw new i("Invalid token specified: must be a string");t||(t={});let e=t.header===!0?0:1,r=o.split(".")[e];if(typeof r!="string")throw new i(`Invalid token specified: missing part #${e+1}`);let p;try{p=y(r)}catch(l){throw new i(`Invalid token specified: invalid base64 for part #${e+1} (${l.message})`)}try{return JSON.parse(p)}catch(l){throw new i(`Invalid token specified: invalid json for part #${e+1} (${l.message})`)}}var s="auth_token",S="user_info";var k=class o{httpService=c(h);router=c(f);user=m(null);login(t){return this.httpService.post("User/login",t).pipe(d(e=>{e.token&&(this.setToken(e.token),this.setUser())}),g(e=>(this.clearAuthData(),u(()=>e))))}constructor(){this.setUser()}setUser(){let t=this.getStoredToken();if(t){let e=this.decodeToken(t);e&&this.user.set({nameid:e.nameid,uniqueName:e.unique_name,role:e.role,companyId:e.CompanyId})}else this.user.set(null)}logout(){this.clearAuthData(),this.router.navigate([b])}isAuthenticated(){return this.getToken()!==null}getToken(){return this.getStoredToken()}decodeToken(t){let e=t||this.getStoredToken();if(!e)return null;try{return v(e)}catch(r){return console.error("Error decoding token:",r),null}}hasRole(t){let e=this.decodeToken();return!e||!e.role?!1:Array.isArray(t)?t.includes(e.role):e?.role===t}setToken(t){localStorage.setItem(s,t)}getStoredToken(){return localStorage.getItem(s)}clearAuthData(){localStorage.removeItem(s),localStorage.removeItem(S)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};var I=class o{get apiUrl(){return n.apiUrl}get isProduction(){return n.production}get appName(){return n.appName}get version(){return n.version}get enableLogging(){return n.enableLogging}get enableDebugMode(){return n.enableDebugMode}log(t){this.enableLogging&&console.log(`[${this.appName}]:`,t)}debug(t){this.enableDebugMode&&console.debug(`[${this.appName} DEBUG]:`,t)}static \u0275fac=function(e){return new(e||o)};static \u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})};export{b as a,R as b,w as c,N as d,k as e};
