import{a as $,b as H}from"./chunk-HHNU67NF.js";import{a as J}from"./chunk-VN2DWCR7.js";import{a as q,b as B}from"./chunk-IJ4WXL4G.js";import"./chunk-FQFQXYMG.js";import"./chunk-GUBCOLOF.js";import"./chunk-PGWBVQKT.js";import{a as G,b as z,c as Y,d as j}from"./chunk-COKV7JKV.js";import{b as T,c as m,e as k,f as I,g as V,h as v,i as N,k as P,l as A,m as D,o as O}from"./chunk-A23VZRFP.js";import{a as M}from"./chunk-354WL4MM.js";import"./chunk-TETLBYVM.js";import"./chunk-GGQ7LRWG.js";import{A as L,y as x}from"./chunk-645P5KEC.js";import"./chunk-TBYF2LDC.js";import{b as R,c as U}from"./chunk-6KR62BTE.js";import{f as w,h as F}from"./chunk-6M5HUDFR.js";import{p as _}from"./chunk-RSINUCQW.js";import{A as E,Fa as a,Fb as s,Hb as b,Qa as S,R as u,fb as c,gb as f,kb as d,lb as n,mb as o,nb as p,sb as h,tb as y}from"./chunk-SWFXP6AJ.js";import"./chunk-EQDQRRRY.js";function Q(r,t){r&1&&(n(0,"small",10),s(1," Username is required (3-20 characters) "),o())}function W(r,t){r&1&&(n(0,"small",10),s(1," Password is required (6-20 characters) "),o())}function X(r,t){r&1&&(n(0,"small",10),s(1," Company is required "),o())}function Z(r,t){if(r&1&&(n(0,"div",7)(1,"label",19),s(2,"Company"),o(),n(3,"div",15),p(4,"p-dropdown",20),o(),c(5,X,2,0,"small",10),o()),r&2){let i,e=y();a(4),d("options",e.companies)("showClear",!0)("filter",!0),a(),f((i=e.inputForm.get("companyId"))!=null&&i.invalid&&((i=e.inputForm.get("companyId"))!=null&&i.touched)?5:-1)}}var K=class r{inputForm;isLoading=!1;systemRoles=U;ROLES_ENUM=R;companies=[];editMode=!1;router=u(F);usersService=u(J);toaster=u(M);activatedRoute=u(w);constructor(){this.initializeForm(),this.listenToRoleChanges(),this.processEditMode()}navigateBack(){this.router.navigate(["users"])}getCompanies(){this.usersService.getCompanies().subscribe({next:t=>{this.companies=t},error:t=>{this.toaster.showError("Failed to load companies")}})}onSaveClick(){if(this.isLoading=!0,this.inputForm.invalid){this.inputForm.markAllAsTouched(),this.isLoading=!1;return}let t=this.inputForm.value;(this.editMode?this.usersService.update(t):this.usersService.create(t)).pipe(E(()=>this.isLoading=!1)).subscribe({next:()=>{let e=`user ${this.editMode?"updated":"created"} successfully`;this.toaster.showSuccess(e),this.navigateBack()}})}processEditMode(){let t=this.activatedRoute.snapshot.paramMap.get("id");t&&(this.editMode=!0,this.usersService.getUserById(t).subscribe({next:i=>{console.log({user:i}),this.inputForm.patchValue(i),this.inputForm.get("password")?.setValidators([]),this.inputForm.get("password")?.updateValueAndValidity()},error:i=>{this.toaster.showError("Failed to load user data")}}))}listenToRoleChanges(){let t=this.inputForm.get("role");t&&t.valueChanges.subscribe(i=>{this.inputForm.get("companyId")?.setValue(null),i==="employee"&&this.companies?.length===0&&this.getCompanies()})}initializeForm(){this.inputForm=new V({id:new v(null),username:new v(null,[m.required,m.minLength(3),m.maxLength(20)]),password:new v(null,[m.required,m.minLength(6),m.maxLength(20)]),role:new v(null,[m.required]),companyId:new N(null,[r.companyIdValidator()])})}static companyIdValidator(){return t=>{let i=t.value,e=t.parent;if(!e)return null;let l=e.get("role");return l&&l.value==="employee"&&!i?{required:!0}:null}}static \u0275fac=function(i){return new(i||r)};static \u0275cmp=S({type:r,selectors:[["app-add-edit-user"]],decls:28,vars:9,consts:[[1,"page"],[1,"page-header"],[1,"btn","btn-outline","border-0",3,"click"],[1,"pi","pi-angle-left","text-2xl"],[1,"page-header-title"],[1,"page-content"],[1,"input-form",3,"formGroup"],[1,"form-field"],["for","username",1,"field-label"],["pInputText","","id","username","formControlName","username","placeholder","Enter username",1,"w-full"],[1,"error-message"],[1,"form-field","field-suffix-container"],["for","password",1,"field-label"],["id","password","formControlName","password","placeholder","Enter password",3,"toggleMask","feedback"],["for","role",1,"field-label"],[1,"field-suffix-container"],["id","role","formControlName","role","optionValue","value","optionLabel","label","placeholder","Select a Role",1,"w-full",3,"options"],[1,"form-actions"],["pButton","","type","submit","size","large","label","Save",1,"btn","btn-primary",3,"click","loading"],["for","company",1,"field-label"],["id","company","formControlName","companyId","optionLabel","name","optionValue","id","placeholder","Select a Company",1,"w-full",3,"options","showClear","filter"]],template:function(i,e){if(i&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),h("click",function(){return e.navigateBack()}),p(3,"i",3),o(),n(4,"h1",4),s(5),o()(),n(6,"div",5)(7,"p-card")(8,"form",6)(9,"div",7)(10,"label",8),s(11,"Username"),o(),p(12,"input",9),c(13,Q,2,0,"small",10),o(),n(14,"div",11)(15,"label",12),s(16,"Password"),o(),n(17,"div"),p(18,"p-password",13),o(),c(19,W,2,0,"small",10),o(),n(20,"div",7)(21,"label",14),s(22,"Role"),o(),n(23,"div",15),p(24,"p-dropdown",16),o()(),c(25,Z,6,4,"div",7),o(),n(26,"div",17)(27,"button",18),h("click",function(){return e.onSaveClick()}),o()()()()()),i&2){let l,C,g;a(5),b(" ",e.editMode?"Edit":"Create new"," user "),a(3),d("formGroup",e.inputForm),a(5),f((l=e.inputForm.get("username"))!=null&&l.invalid&&((l=e.inputForm.get("username"))!=null&&l.touched)?13:-1),a(5),d("toggleMask",!0)("feedback",!1),a(),f((C=e.inputForm.get("password"))!=null&&C.invalid&&((C=e.inputForm.get("password"))!=null&&C.touched)?19:-1),a(5),d("options",e.systemRoles),a(),f(((g=e.inputForm.get("role"))==null?null:g.value)===e.ROLES_ENUM.EMPLOYEE&&e.companies.length?25:-1),a(2),d("loading",e.isLoading)}},dependencies:[_,O,P,T,k,I,A,D,z,G,H,$,B,q,L,x,j,Y],encapsulation:2})};export{K as CreateUserComponent};
